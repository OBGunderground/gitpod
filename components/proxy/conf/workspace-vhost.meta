https://*.*.{$GITPOD_DOMAIN} {
	import enable_log
	import workspace_security_headers
	import remove_server_header
	import ssl_configuration
	import debug_headers

    # We have to differentiate two cases to mimic the ws-proxy behavior:
    # - requests to the IDE frontend: redirect to "/start?not_found=true#..."
    # - everything else: respond with 404

	@workspace header_regexp host Host ^(?P<workspaceID>[a-z0-9][0-9a-z\-]+).ws(?P<location>-[a-z0-9]+)?.{$GITPOD_DOMAIN}
	handle @workspace {
        redir https://{$GITPOD_DOMAIN}/?not_found=true#{re.host.workspaceID} temporary
	}

	respond "Not found" 404
}
